<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments :: head"></head>

<body class="container">
<div th:replace="fragments :: navigation"></div>

<div id="map" style="width:100%;height:550px;"></div>


<script th:inline="javascript">
    /*<![CDATA[*/
      var locations = /*[[${locations}]]*/
      var jsonlocations = [];

      for (var i=0; i < locations.length; i++){
        var x = $.parseJSON(locations[i]);
        jsonlocations.push(x);
      }

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {zoom: 10});
        var geocoder = new google.maps.Geocoder;

        var location = /*[[${location}]]*/
        var radius = /*[[${radius}]]*/

        var x = new google.maps.LatLng(location[0], location[1]);


        for (var i=0; i < jsonlocations.length; i++){
        geocoder.geocode({'address': jsonlocations[i].address}, function(results, status) {
          if (status === 'OK') {
            map.setCenter({lat: 38.655602, lng: -90.301732});

            var y = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
            var distance = google.maps.geometry.spherical.computeDistanceBetween(x,y);

            if (distance < radius){
                new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location
                });
            }
          } else {
            window.alert('Geocode was not successful for the following reason: ' +
                status);
          }
        });
        }
      }
    /*]]>*/
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHu2rc07DmlSD9dUSQAoevnexR8DWXTgE&amp;libraries=geometry&amp;callback=initMap">
</script>


</body>
</html>

